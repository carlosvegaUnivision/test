# This is a basic workflow that is manually triggered

name: Promote to Upper Environment

on:
  workflow_dispatch:
    inputs:
      from:
        type: choice
        required: true
        description: 'From: '
        default: 'DEV'
        options:
        - DEV
        - QA
        - STG
      version:
        description: 'Version:'
        default: ''
        required: true
      to:
        type: choice
        required: true
        description: 'To: '
        default: 'QA'
        options:
        - QA
        - STG
        - PROD
      message:
        description: 'Message:'
        default: 'chore(release): ...'
        required: true

jobs:
  promote:
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.WORKFLOW_TOKEN }}
        env:
          GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}
      - name: "Promote to Upper Environment"
        run: |
          git config --global user.email "u1200112@unimilitar.edu.co"
          git config --global user.name "Carlos Vega"
          git pull
          git fetch --tags
          from_tag=$([[ ${{github.event.inputs.from}} = DEV ]] && echo v${{github.event.inputs.version}} || echo ${{github.event.inputs.version}}-beta)
          to_tag=$([[ ${{github.event.inputs.to}} = QA ]] && echo ${{github.event.inputs.version}}-beta || echo ${{github.event.inputs.version}}-rc)
          git checkout tags/$from_tag
          git commit --allow-empty --allow-empty-message -m ""
          git tag -a $to_tag -m "${{ github.event.inputs.message }}"
          git push origin $to_tag

